#!/bin/bash

# path
# Homebrew installs to /usr/local/sbin and /usr/local/opt/coreutils/libexec/gnubin
for p in "$HOME/.bin" "/usr/local/sbin" "/usr/local/opt/coreutils/libexec/gnubin"; do
  test -d "$p" && export PATH="$p":$PATH
done

# Setup terminal, and turn on colors
# export TERM=xterm-256color
export LANG=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8
export LC_MESSAGES=en_US.UTF-8
export LC_COLLATE=C

# misc
alias tf='tail -f'
alias ln='ln -v'
alias mkdir='mkdir -p'
alias ...='../..'
alias ....='../../..'
alias df='df -h'

# grep
export GREP_COLOR='3;33'
alias grep='grep --color=auto'

# Enable aliases to be sudoâ€™ed
alias sudo='sudo '

# ls
# add formatting and color to `ls`
# Detect which `ls` flavor is in use
export CLICOLOR=1
export LSCOLORS=ExFxCxDxBxegedabagacad
export LS_COLORS="di=34:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34:su=0:sg=0:tw=0:ow=0:"
if ls --color > /dev/null 2>&1; then # GNU `ls`
  colorflag="--color"
else # BSD `ls`
  colorflag="-G"
fi
alias ls="command ls -Fh $colorflag"
alias l='ls'
alias lh='ls -Alh'
alias ll='ls -Fhl'
alias lsd="ls -lF $colorflag | grep --color=never '^d'"
alias lt='ls -hltr'

# neovim / vim
if installed nvim; then
  alias vi='nvim'
  alias vim='nvim'
  export EDITOR="$(which nvim)"
elif installed vim; then
  alias vi='vim'
  export EDITOR="$(which vim)"
fi

# git
alias g="git"
alias gs="git status"
alias ga="git add"
alias gc="git commit"
alias gcm="git commit -m"
alias gp="git push"
# tell git to non-interactively merge commits
export GIT_MERGE_AUTOEDIT=no
alias gpl='git log --pretty=format:"%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset" --abbrev-commit'

# tmux
alias t='tmux'

# ssh
alias sst='ssh -t "tmux -CC attach; or tmux -CC"'

# PAGER
# use vimpager if available
if installed vimpager; then
  export PAGER="$(which vimpager)"
  alias less="$PAGER"
  alias zless="$PAGER"
elif installed source-highlight; then
  export LESSOPEN="| /usr/local/bin/src-hilite-lesspipe.sh %s"
  export LESS=" -R "
  alias less='less -m -g -i -J --underline-special --SILENT'
  alias more='less'
fi

# vagrant
alias v='vagrant'

# Network
alias whats-my-ip='curl -s https://diagnostic.opendns.com/myip'
alias dis='dig +nocmd +noall +answer'

# Reload the shell (i.e. invoke as a login shell)
alias reload="exec $SHELL -l"

# GRC
if installed grc; then
  alias colourify="$(which grc) -es --colour=auto"
  alias configure='colourify ./configure'
  alias diff='colourify diff'
  alias make='colourify make'
  alias gcc='colourify gcc'
  alias g++='colourify g++'
  alias as='colourify as'
  alias gas='colourify gas'
  alias ld='colourify ld'
  alias netstat='colourify netstat'
  alias ping='colourify ping'
  alias traceroute='colourify traceroute'
  alias tracepath='colourify -c conf.traceroute tracepath'
  alias arp='colourify -c conf.traceroute arp'
  alias tail='colourify -c conf.log tail'
  alias ps='colourify -c conf.ps ps'
  alias ifconfig='colourify -c conf.traceroute ifconfig'
  alias nmap='colourify -c conf.nmap nmap'
  alias lsof='colourify -c conf.traceroute lsof'
  alias dig='colourify -c conf.traceroute dig'
  alias host='colourify -c conf.traceroute host'
  alias drill='colourify -c conf.traceroute drill'
  alias curl='colourify curl'
fi

# minicom
export MINICOM='-c on'

# python venv
export VIRTUAL_ENV_DISABLE_PROMPT=true

# boot-clj
export BOOT_JVM_OPTIONS='-client -XX\:+TieredCompilation -XX\:TieredStopAtLevel\=1 -Xmx2g -XX\:+UseConcMarkSweepGC -XX\:+CMSClassUnloadingEnabled -Xverify\:none -XX\:+AggressiveOpts'

case $(uname) in
  Linux) ;;
  'CYGWIN*') ;;
  Darwin)
    # Show/hide hidden files in Finder
    alias show-hidden-files="defaults write com.apple.finder AppleShowAllFiles -bool true; and killall Finder"
    alias hide-hidden-files="defaults write com.apple.finder AppleShowAllFiles -bool false; and killall Finder"

    # Merge PDF files
    # Usage: `mergepdf -o output.pdf input{1,2,3}.pdf`
    alias mergepdf='/System/Library/Automator/Combine\ PDF\ Pages.action/Contents/Resources/join.py'

    # Disable Spotlight
    alias spotoff="sudo mdutil -a -i off"
    # Enable Spotlight
    alias spoton="sudo mdutil -a -i on"
    ;;
esac
