#!/bin/bash
# Update Arch Linux

if [ -e '/etc/arch-release' ]; then
  echo "Updating Arch Linux"
  sudo /usr/bin/pacman -Syu --noconfirm
  sudo /usr/bin/pacman -Qtdq > /dev/null && \
    sudo /usr/bin/pacman -Rns "$(/usr/bin/pacman -Qtdq | sed -e ':a;N;\$!ba;s/\n/ /g')"
  sudo paccache -r
  sudo paccache -ruk0
  sudo pacman-optimize

  restore_loc="$(find-dotfiles)/scripts/arch_packages"
  echo "Saving packages list to: $restore_loc"
  pacman -Qqe > "$restore_loc"
else
  echo "Not running Arch Linux, skipping"
fi
