#!/bin/bash
# Update iterm2

bin_dir="$HOME/.bin"

APPLESCRIPT=`cat <<EOF
on run argv
  try
    tell application "Finder"
      set appname to name of application file id "com.googlecode.iterm2"
      return 1
    end tell
  on error err_msg number err_num
    return 0
  end try
end run
EOF`

if [[ "$*" == *--save* ]] && [ $(uname) = "Darwin" ] && [ $(osascript -e "$APPLESCRIPT") = 1 ]; then
  echo "Downloading the latest iterm2 shell integration scripts..."
  curl -L "https://iterm2.com/misc/fish_startup.in" >"$bin_dir/iterm2_shell_integration.fish"
  curl -L "https://iterm2.com/misc/bash_startup.in" >"$bin_dir/iterm2_shell_integration.bash"
  curl -L "https://iterm2.com/misc/zsh_startup.in" >"$bin_dir/iterm2_shell_integration.zsh"
  curl -L "https://raw.github.com/gnachman/iTerm2/master/tests/imgls" >"$bin_dir/imgls"
  curl -L "https://raw.github.com/gnachman/iTerm2/master/tests/imgcat" >"$bin_dir/imgcat"
  curl -L "https://raw.github.com/gnachman/iTerm2/master/tests/download.sh" >"$bin_dir/download.sh"
  curl -L "https://raw.github.com/gnachman/iTerm2/master/tests/divider" >"$bin_dir/divider"
  chmod +x "$bin_dir/iterm2_shell_integration."* "$bin_dir/imgls" "$bin_dir/imgcat" "$bin_dir/download.sh" "$bin_dir/divider"
else
  echo "Skipping iTerm"
fi
